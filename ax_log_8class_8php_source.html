<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>Axiom: H:/Workspace/php-axiom/www/php-axiom/libraries/axiom/axLog.class.php Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="new_stylesheet.css" rel="stylesheet" type="text/css" />
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
	<h1>Axiom (v1.2.0)</h1>
	<span>A lightweight PHP framework</span>
	        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>

</div>

<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="dynsections.js"></script>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('ax_log_8class_8php.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">H:/Workspace/php-axiom/www/php-axiom/libraries/axiom/axLog.class.php</div>  </div>
</div><!--header-->
<div class="contents">
<a href="ax_log_8class_8php.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 &lt;?php
<a name="l00020"></a><a class="code" href="classax_log.html">00020</a> <span class="keyword">class </span><a class="code" href="classax_log.html" title="Log Class.">axLog</a> {
<a name="l00021"></a>00021     
<a name="l00026"></a><a class="code" href="classax_log.html#a1df8582275252b754f270c1bf41515d7">00026</a>     <span class="keyword">protected</span> <a class="code" href="classax_log.html#a1df8582275252b754f270c1bf41515d7" title="Configuration.">$_options</a>;
<a name="l00027"></a>00027     
<a name="l00032"></a><a class="code" href="classax_log.html#a69f0189d330124e81c5e6b8821d1d0b5">00032</a>     <span class="keyword">protected</span> <a class="code" href="classax_log.html#a69f0189d330124e81c5e6b8821d1d0b5" title="First logger in the chain.">$_first</a>;
<a name="l00033"></a>00033     
<a name="l00038"></a><a class="code" href="classax_log.html#a66f3fca8a1a6b091a95b24e6dbacc35f">00038</a>     <span class="keyword">protected</span> <a class="code" href="classax_log.html#a66f3fca8a1a6b091a95b24e6dbacc35f" title="Last logger in the chain.">$_last</a>;
<a name="l00039"></a>00039     
<a name="l00044"></a><a class="code" href="classax_log.html#a6b43d1a3d75da0e856cc118fd93994a6">00044</a>     <span class="keyword">protected</span> <a class="code" href="classax_log.html#a6b43d1a3d75da0e856cc118fd93994a6" title="Log messages history (per request)">$_message_history</a> = array();
<a name="l00045"></a>00045     
<a name="l00060"></a><a class="code" href="classax_log.html#ad9f97dc3b395671f3c5e660f35d7effb">00060</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classax_log.html#ad9f97dc3b395671f3c5e660f35d7effb" title="Constructor.">__construct</a> (array $options = array()) {
<a name="l00061"></a>00061                 $default = array(
<a name="l00062"></a>00062                                                 <span class="stringliteral">&#39;ignore_repeated_messages&#39;</span> =&gt; <span class="keyword">true</span>,
<a name="l00063"></a>00063                                 <span class="stringliteral">&#39;log_errors&#39;</span> =&gt; <span class="keyword">true</span>,
<a name="l00064"></a>00064                                 <span class="stringliteral">&#39;log_exception&#39;</span> =&gt; <span class="keyword">true</span>,
<a name="l00065"></a>00065                 );
<a name="l00066"></a>00066                 
<a name="l00067"></a>00067                 $this-&gt;_options = $options;
<a name="l00068"></a>00068                 
<a name="l00069"></a>00069                 <span class="keywordflow">if</span> ($this-&gt;_options[<span class="stringliteral">&#39;log_errors&#39;</span>])
<a name="l00070"></a>00070             $this-&gt;<a class="code" href="classax_log.html#af5a1bb036a561abc5344cf357de534eb" title="Register instance as PHP error handler.">registerErrorHandler</a>();
<a name="l00071"></a>00071             
<a name="l00072"></a>00072         <span class="keywordflow">if</span> ($this-&gt;_options[<span class="stringliteral">&#39;log_exception&#39;</span>])
<a name="l00073"></a>00073             $this-&gt;<a class="code" href="classax_log.html#a72cc5d4c1d4603fd3f4c1c665add56ab" title="Register Log as PHP exception handler.">registerExceptionHandler</a>();
<a name="l00074"></a>00074     }
<a name="l00075"></a>00075     
<a name="l00084"></a><a class="code" href="classax_log.html#a280aa98c87ad5a0c377e4dcab0cee42b">00084</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classax_log.html#a280aa98c87ad5a0c377e4dcab0cee42b" title="Push a message onto the chain.">message</a> ($msg, $priority) {
<a name="l00085"></a>00085         <span class="keywordflow">if</span> (!isset($this-&gt;_first))
<a name="l00086"></a>00086             <span class="keywordflow">return</span> $this;
<a name="l00087"></a>00087         
<a name="l00088"></a>00088         <span class="keywordflow">if</span> ($this-&gt;_options[<span class="stringliteral">&#39;ignore_repeated_messages&#39;</span>] &amp;&amp; array_search($msg, $this-&gt;_message_history) !== <span class="keyword">false</span>)
<a name="l00089"></a>00089                                                 <span class="keywordflow">return</span> $this;
<a name="l00090"></a>00090         
<a name="l00091"></a>00091         $this-&gt;_first-&gt;message($this-&gt;_message_history[] = $msg, $priority);
<a name="l00092"></a>00092         <span class="keywordflow">return</span> $this;
<a name="l00093"></a>00093     }
<a name="l00094"></a>00094     
<a name="l00101"></a><a class="code" href="classax_log.html#a98682ff7b4c8f438ba8b49d6cd1ca869">00101</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classax_log.html#a98682ff7b4c8f438ba8b49d6cd1ca869" title="Push an error message onto the chain.">error</a> ($msg) {
<a name="l00102"></a>00102         <span class="keywordflow">return</span> $this-&gt;<a class="code" href="classax_log.html#a280aa98c87ad5a0c377e4dcab0cee42b" title="Push a message onto the chain.">message</a>($msg, <a class="code" href="classax_logger.html#ade487db4a22a973431571c8efc5cb0e8">axLogger::ERR</a>);
<a name="l00103"></a>00103     }
<a name="l00104"></a>00104     
<a name="l00111"></a><a class="code" href="classax_log.html#ad250e8ba5871e624960fa9f2f5674859">00111</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classax_log.html#ad250e8ba5871e624960fa9f2f5674859" title="Push a notice message onto the chain.">notice</a> ($msg) {
<a name="l00112"></a>00112         <span class="keywordflow">return</span> $this-&gt;<a class="code" href="classax_log.html#a280aa98c87ad5a0c377e4dcab0cee42b" title="Push a message onto the chain.">message</a>($msg, <a class="code" href="classax_logger.html#ac8332324f2ccd1009199c326c09476db">axLogger::NOTICE</a>);
<a name="l00113"></a>00113     }
<a name="l00114"></a>00114     
<a name="l00121"></a><a class="code" href="classax_log.html#a8fa7794f55cad31aa00dbdd9128c5136">00121</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classax_log.html#a8fa7794f55cad31aa00dbdd9128c5136" title="Push a warning message onto the chain.">warning</a> ($msg) {
<a name="l00122"></a>00122         <span class="keywordflow">return</span> $this-&gt;<a class="code" href="classax_log.html#a280aa98c87ad5a0c377e4dcab0cee42b" title="Push a message onto the chain.">message</a>($msg, <a class="code" href="classax_logger.html#a5c7ac7fe80395ab2b6d781d3e0a5d0f3">axLogger::WARNING</a>);
<a name="l00123"></a>00123     }
<a name="l00124"></a>00124     
<a name="l00133"></a><a class="code" href="classax_log.html#a3017064c9ad9f9b2730d2c749517b8ef">00133</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classax_log.html#a3017064c9ad9f9b2730d2c749517b8ef" title="Push a debug message onto the chain.">debug</a> ($msg, array $bt = array()) {
<a name="l00134"></a>00134         <span class="keywordflow">if</span> ($bt)
<a name="l00135"></a>00135             $msg .= <span class="stringliteral">&quot; in {$bt[0][&#39;file&#39;]} on line {$bt[0][&#39;line&#39;]}&quot;</span>;
<a name="l00136"></a>00136         
<a name="l00137"></a>00137         <span class="keywordflow">return</span> $this-&gt;<a class="code" href="classax_log.html#a280aa98c87ad5a0c377e4dcab0cee42b" title="Push a message onto the chain.">message</a>($msg, <a class="code" href="classax_logger.html#a28c35250a436286d25e80743d50d57fc">axLogger::DEBUG</a>);
<a name="l00138"></a>00138     }
<a name="l00139"></a>00139     
<a name="l00145"></a><a class="code" href="classax_log.html#abe881423946fb2e76eb3d863e6ca4a14">00145</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classax_log.html#abe881423946fb2e76eb3d863e6ca4a14" title="Attach a logger to the chain.">addLogger</a> (<a class="code" href="classax_logger.html" title="Logger Abstract Class.">axLogger</a> $logger) {
<a name="l00146"></a>00146         <span class="keywordflow">if</span> (!isset($this-&gt;_first))
<a name="l00147"></a>00147             $this-&gt;_first = $this-&gt;_last = $logger;
<a name="l00148"></a>00148         <span class="keywordflow">else</span>
<a name="l00149"></a>00149             $this-&gt;_last-&gt;<a class="code" href="classax_logger.html#a43b8dd73b9f7e55a3628d338fddad423" title="Set next logger in chain and return the attached logger.">setNext</a>($this-&gt;_last = $logger);
<a name="l00150"></a>00150         <span class="keywordflow">return</span> $this;
<a name="l00151"></a>00151     }
<a name="l00152"></a>00152     
<a name="l00158"></a><a class="code" href="classax_log.html#af5a1bb036a561abc5344cf357de534eb">00158</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classax_log.html#af5a1bb036a561abc5344cf357de534eb" title="Register instance as PHP error handler.">registerErrorHandler</a> ($error_types = -1) {
<a name="l00159"></a>00159         <span class="keywordflow">return</span> set_error_handler(array($this, <span class="stringliteral">&#39;handleError&#39;</span>));
<a name="l00160"></a>00160     }
<a name="l00161"></a>00161     
<a name="l00166"></a><a class="code" href="classax_log.html#a825d89ed7abc1530a865741247658ecc">00166</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classax_log.html#a825d89ed7abc1530a865741247658ecc">restoreErrorHandler</a> () {
<a name="l00167"></a>00167         <span class="keywordflow">return</span> restore_error_handler();
<a name="l00168"></a>00168     }
<a name="l00169"></a>00169     
<a name="l00179"></a><a class="code" href="classax_log.html#afcf2a5d9e25f1a2e4772a108bdd1c429">00179</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classax_log.html#afcf2a5d9e25f1a2e4772a108bdd1c429">handleError</a> ($errno, $errstr, $errfile, $errline) {
<a name="l00180"></a>00180         $error = <span class="stringliteral">&quot;(PHP Error) $errstr in $errfile on line $errline&quot;</span>;
<a name="l00181"></a>00181         <span class="keywordflow">switch</span> ($errno) {
<a name="l00182"></a>00182             <span class="keywordflow">case</span> E_STRICT:
<a name="l00183"></a>00183             <span class="keywordflow">case</span> E_WARNING:
<a name="l00184"></a>00184             <span class="keywordflow">case</span> E_USER_WARNING:
<a name="l00185"></a>00185                 $this-&gt;<a class="code" href="classax_log.html#a8fa7794f55cad31aa00dbdd9128c5136" title="Push a warning message onto the chain.">warning</a>($error);
<a name="l00186"></a>00186                 <span class="keywordflow">break</span>;
<a name="l00187"></a>00187                 
<a name="l00188"></a>00188             <span class="keywordflow">case</span> E_NOTICE:
<a name="l00189"></a>00189             <span class="keywordflow">case</span> E_USER_NOTICE:
<a name="l00190"></a>00190                 $this-&gt;<a class="code" href="classax_log.html#ad250e8ba5871e624960fa9f2f5674859" title="Push a notice message onto the chain.">notice</a>($error);
<a name="l00191"></a>00191                 <span class="keywordflow">break</span>;
<a name="l00192"></a>00192             
<a name="l00193"></a>00193             <span class="keywordflow">case</span> E_USER_ERROR:
<a name="l00194"></a>00194                 $this-&gt;<a class="code" href="classax_log.html#a98682ff7b4c8f438ba8b49d6cd1ca869" title="Push an error message onto the chain.">error</a>($error);
<a name="l00195"></a>00195                 <span class="keywordflow">break</span>;
<a name="l00196"></a>00196                 
<a name="l00197"></a>00197             <span class="keywordflow">default</span>:
<a name="l00198"></a>00198             <span class="keywordflow">case</span> E_RECOVERABLE_ERROR:
<a name="l00199"></a>00199                 <span class="keywordflow">throw</span> <span class="keyword">new</span> ErrorException($errstr, 2048, $errno, $errfile, $errline);
<a name="l00200"></a>00200                 <span class="keywordflow">break</span>;
<a name="l00201"></a>00201         }
<a name="l00202"></a>00202     }
<a name="l00203"></a>00203     
<a name="l00208"></a><a class="code" href="classax_log.html#a72cc5d4c1d4603fd3f4c1c665add56ab">00208</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classax_log.html#a72cc5d4c1d4603fd3f4c1c665add56ab" title="Register Log as PHP exception handler.">registerExceptionHandler</a> () {
<a name="l00209"></a>00209         <span class="keywordflow">return</span> set_exception_handler(array($this, <span class="stringliteral">&#39;handleException&#39;</span>));
<a name="l00210"></a>00210     }
<a name="l00211"></a>00211     
<a name="l00216"></a><a class="code" href="classax_log.html#a767d14412a9ab37fcd3c50fdfe4699c7">00216</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classax_log.html#a767d14412a9ab37fcd3c50fdfe4699c7" title="Unregister Log as PHP exception handler.">restoreExceptionHandler</a> () {
<a name="l00217"></a>00217         <span class="keywordflow">return</span> restore_exception_handler();
<a name="l00218"></a>00218     }
<a name="l00219"></a>00219     
<a name="l00229"></a><a class="code" href="classax_log.html#aa1bbe27cedd9bc0d2539405670e0abed">00229</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classax_log.html#aa1bbe27cedd9bc0d2539405670e0abed" title="Handle an exception.">handleException</a> (Exception $exception) {
<a name="l00230"></a>00230         <span class="keywordflow">if</span> (PHP_VERSION_ID &gt;= 50300) {
<a name="l00231"></a>00231             <span class="keywordflow">if</span> ($previous = $exception-&gt;getPrevious()) {
<a name="l00232"></a>00232                 $this-&gt;<a class="code" href="classax_log.html#aa1bbe27cedd9bc0d2539405670e0abed" title="Handle an exception.">handleException</a>($previous);
<a name="l00233"></a>00233             }
<a name="l00234"></a>00234         }
<a name="l00235"></a>00235         
<a name="l00236"></a>00236         $error = <span class="stringliteral">&quot;(PHP Exception) &quot;</span> . $exception-&gt;getMessage() . <span class="stringliteral">&#39; in &#39;</span> . $exception-&gt;getFile() . <span class="stringliteral">&#39; on line &#39;</span> . 
<a name="l00237"></a>00237             $exception-&gt;getLine();
<a name="l00238"></a>00238         $this-&gt;<a class="code" href="classax_log.html#a98682ff7b4c8f438ba8b49d6cd1ca869" title="Push an error message onto the chain.">error</a>($error);
<a name="l00239"></a>00239     }
<a name="l00240"></a>00240     
<a name="l00245"></a><a class="code" href="classax_log.html#a1aa00fb371d13a18533086bd267b36ef">00245</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classax_log.html#a1aa00fb371d13a18533086bd267b36ef" title="Get messages history.">getHistory</a> () {
<a name="l00246"></a>00246         <span class="keywordflow">return</span> $this-&gt;_message_history;
<a name="l00247"></a>00247     }
<a name="l00248"></a>00248 }
<a name="l00249"></a>00249 
</pre></div></div><!-- contents -->
</div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="ax_log_8class_8php.html">axLog.class.php</a>      </li>

    <li class="footer">Generated on Tue Feb 28 2012 14:08:34 for Axiom by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.6.1 </li>
   </ul>
 </div>


</body>
</html>
